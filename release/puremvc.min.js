var __extends=this&&this.__extends||function(){var o=function(e,t){o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r))e[r]=t[r]};return o(e,t)};return function(e,t){o(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();var puremvc;(function(e){var l=function(){function e(){this.$commands={};if(e.inst!==null){throw Error("Controller singleton already constructed!")}e.inst=this}e.prototype.executeCommand=function(e,t){var r=new this.$commands[e];if(t instanceof Array){r.execute.apply(r,t)}else{r.execute.call(r,t)}};e.prototype.registerCommand=function(e,t,r,o){if(this.hasCommand(e)===true){throw Error("Register duplicate command: "+e)}this.$commands[e]=t;n.inst.registerObserver(e,this.executeCommand,this,false,r,o)};e.prototype.removeCommand=function(e){if(this.hasCommand(e)===false){throw Error("Remove non-existent command: "+e)}delete this.$commands[e];n.inst.removeObserver(e,this.executeCommand,this)};e.prototype.hasCommand=function(e){return this.$commands[e]!==void 0};e.inst=null;return e}();e.Controller=l;var h=function(){function e(){this.$view=new n;this.$model=new t;this.$controller=new l;if(e.inst!==null){throw Error("Facade singleton already constructed!")}e.inst=this;this.$initializeFacade()}e.getInstance=function(){if(e.inst===null){e.inst=new e}return e.inst};e.prototype.$initializeFacade=function(){this.$initializeModel();this.$initializeController();this.$initializeView()};e.prototype.$initializeModel=function(){};e.prototype.$initializeView=function(){};e.prototype.$initializeController=function(){};e.prototype.registerObserver=function(e,t,r,o,i,n){this.$view.registerObserver(e,t,r,o,i,n)};e.prototype.removeObserver=function(e,t,r){this.$view.removeObserver(e,t,r)};e.prototype.registerCommand=function(e,t,r,o){this.$controller.registerCommand(e,t,r,o)};e.prototype.removeCommand=function(e){this.$controller.removeCommand(e)};e.prototype.hasCommand=function(e){return this.$controller.hasCommand(e)};e.prototype.registerProxy=function(e){this.$model.registerProxy(e)};e.prototype.removeProxy=function(e){this.$model.removeProxy(e)};e.prototype.retrieveProxy=function(e){return this.$model.retrieveProxy(e)};e.prototype.hasProxy=function(e){return this.$model.hasProxy(e)};e.prototype.registerMediator=function(e){this.$view.registerMediator(e)};e.prototype.removeMediator=function(e){this.$view.removeMediator(e)};e.prototype.retrieveMediator=function(e){return this.$view.retrieveMediator(e)};e.prototype.hasMediator=function(e){return this.$view.hasMediator(e)};e.prototype.sendNotification=function(e,t,r){this.$view.notifyObservers(e,t,r)};e.prototype.notifyCancel=function(){this.$view.notifyCancel()};e.DEBUG=true;e.inst=null;return e}();e.Facade=h;var t=function(){function e(){this.$proxies={};if(e.inst!==null){throw Error("Model singleton already constructed!")}e.inst=this}e.prototype.registerProxy=function(e){var t=e.getProxyName();if(f(t)===true){throw Error("Register invalid proxy")}if(this.hasProxy(t)===true){throw Error("Register duplicate proxy: "+t)}this.$proxies[t]=e;e.onRegister()};e.prototype.removeProxy=function(e){if(f(e)===true){throw Error("Remove invalid proxy")}if(this.hasProxy(e)===false){throw Error("Remove non-existent proxy: "+e)}var t=this.$proxies[e];delete this.$proxies[e];t.onRemove()};e.prototype.retrieveProxy=function(e){return this.$proxies[e]||null};e.prototype.hasProxy=function(e){return this.$proxies[e]!==void 0};e.inst=null;return e}();e.Model=t;var r=function(){function e(){this.facade=h.getInstance()}return e}();e.Notifier=r;var p=function(){function e(){this.args=null;this.name=null;this.caller=null;this.method=null;this.priority=0;this.receiveOnce=false}return e}();e.Observer=p;var o=function(o){__extends(e,o);function e(e,t){var r=o.call(this)||this;r.$proxyName=null;r.$data=void 0;if(f(e)===true){throw Error("Invalid proxy name")}r.$data=t;r.$proxyName=e;return r}e.prototype.getProxyName=function(){return this.$proxyName||null};e.prototype.onRegister=function(){};e.prototype.onRemove=function(){};e.prototype.getData=function(){return this.$data};e.prototype.setData=function(e){this.$data=e};return e}(r);e.Proxy=o;var i=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(r);e.SimpleCommand=i;var n=function(){function e(){this.$pool=[];this.$lockers={};this.$observers={};this.$isCanceled=false;this.$onceObservers=[];this.$mediators={};if(e.inst!==null){throw Error("View singleton already constructed!")}e.inst=this}e.prototype.registerObserver=function(e,t,r,o,i,n){if(o===void 0){o=false}if(i===void 0){i=2}if(n===void 0){n=null}if(f(e)===true){throw Error("Register invalid observer")}if(t===void 0||t===null){throw Error("Register invalid observer method: "+e)}if(r===void 0){r=null}var s=this.$observers[e];if(s===void 0){s=this.$observers[e]=[]}else if(this.$lockers[e]===true){this.$lockers[e]=false;this.$observers[e]=s=s.slice()}var a=-1;for(var l=0;l<s.length;l++){var c=s[l];if(c.method===t&&c.caller===r){h.DEBUG===true&&console.warn("忽略重复注册的监听 name:"+e);return null}if(a===-1&&c.priority<i){a=l}}var u=this.$pool.length>0?this.$pool.pop():new p;u.args=n;u.name=e;u.caller=r;u.method=t;u.priority=i;u.receiveOnce=o;if(a<0){s.push(u)}else{s.splice(a,0,u)}return u};e.prototype.removeObserver=function(e,t,r){if(f(e)===true){throw Error("Remove invalid observer")}if(t===void 0||t===null){throw Error("Remove invalid observer method: "+e)}if(r===void 0){r=null}var o=this.$observers[e];if(o===void 0){return}if(this.$lockers[e]===true){this.$lockers[e]=false;this.$observers[e]=o=o.slice()}for(var i=0;i<o.length;i++){var n=o[i];if(n.method===t&&n.caller===r){o.splice(i,1);this.$pool.push(n);break}}if(o.length===0){delete this.$lockers[e];delete this.$observers[e]}};e.prototype.notifyObservers=function(e,t,r){if(r===void 0){r=true}if(f(e)===true){throw Error("Notify invalid command")}var o=this.$observers[e];if(o===void 0){return}this.$lockers[e]=true;var i=this.$isCanceled;this.$isCanceled=false;for(var n=0;n<o.length;n++){var s=o[n];if(s.receiveOnce===true){this.$onceObservers.push(s)}var a=s.args===null?t:s.args.concat(t);if(s.caller===l.inst){s.method.call(s.caller,e,a)}else if(a instanceof Array){s.method.apply(s.caller,a)}else{s.method.call(s.caller,a)}if(this.$isCanceled){if(r===true){break}console.error("尝试取消不可被取消的通知："+e);this.$isCanceled=false}}this.$isCanceled=i;this.$lockers[e]=false;while(this.$onceObservers.length>0){var s=this.$onceObservers.pop();this.removeObserver(s.name,s.method,s.caller)}};e.prototype.notifyCancel=function(){this.$isCanceled=true};e.prototype.registerMediator=function(e){var t=e.getMediatorName();if(f(t)===true){throw Error("Register invalid mediator")}if(this.hasMediator(t)===true){throw Error("Register duplicate mediator: "+t)}this.$mediators[t]=e;e.listNotificationInterests();e.onRegister()};e.prototype.removeMediator=function(e){if(f(e)===true){throw Error("Remove invalid mediator")}if(this.hasMediator(e)===false){throw Error("Remove non-existent mediator: "+e)}var t=this.$mediators[e];delete this.$mediators[e];t.removeNotificationInterests();t.onRemove()};e.prototype.retrieveMediator=function(e){return this.$mediators[e]||null};e.prototype.hasMediator=function(e){return this.$mediators[e]!==void 0};e.inst=null;return e}();e.View=n;var s=function(t){__extends(e,t);function e(){var e=t.call(this)||this;e.$commands=[];e.$initializeMacroCommand();return e}e.prototype.$addSubCommand=function(e){this.$commands.push(e)};e.prototype.execute=function(){for(var e=0;e<this.$commands.length;e++){var t=new this.$commands[e];t.execute.apply(t,arguments)}};return e}(r);e.MacroCommand=s;var a=function(o){__extends(e,o);function e(e,t){var r=o.call(this)||this;r.$mediatorName=null;r.$notificationInterests=[];r.$viewComponent=null;if(f(e)===true){throw Error("Invalid mediator name")}r.$mediatorName=e;r.$viewComponent=t||null;return r}e.prototype.getMediatorName=function(){return this.$mediatorName};e.prototype.listNotificationInterests=function(){};e.prototype.removeNotificationInterests=function(){for(var e=0;e<this.$notificationInterests.length;e++){var t=this.$notificationInterests[e];n.inst.removeObserver(t.name,t.method,t.caller)}};e.prototype.$handleNotification=function(e,t,r,o){var i=n.inst.registerObserver(e,t,this,void 0,r,o);i&&this.$notificationInterests.push(i)};e.prototype.onRegister=function(){};e.prototype.onRemove=function(){};e.prototype.getViewComponent=function(){return this.$viewComponent};e.prototype.setViewComponent=function(e){this.$viewComponent=e||null};return e}(r);e.Mediator=a;function f(e){return e===void 0||e===null||e===""}e.isStringNullOrEmpty=f})(puremvc||(puremvc={}));