var __extends=this&&this.__extends||function(){var o=function(e,t){o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r))e[r]=t[r]};return o(e,t)};return function(e,t){o(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();var puremvc;(function(l){var t;(function(e){e[e["NONE"]=65535]="NONE";e[e["CUSTOM"]=65536]="CUSTOM";e[e["TIMELINE"]=65537]="TIMELINE"})(t=l.CareModuleID||(l.CareModuleID={}));var M=function(){function e(){this.$commands={};if(e.inst!==null){throw Error("重复构建控制类！！！")}e.inst=this}e.prototype.executeCommand=function(e,t){var r=new this.$commands[e];if(t instanceof Array){r.execute.apply(r,t)}else{r.execute.call(r,t)}};e.prototype.registerCommand=function(e,t,r,o){if(this.hasCommand(e)===true){throw Error("重复注册命令："+e)}this.$commands[e]=t;n.inst.registerObserver(e,this.executeCommand,this,false,r,o)};e.prototype.removeCommand=function(e){if(this.hasCommand(e)===false){throw Error("移除不存在的命令："+e)}delete this.$commands[e];n.inst.removeObserver(e,this.executeCommand,this)};e.prototype.hasCommand=function(e){return this.$commands[e]!==void 0};e.inst=null;return e}();l.Controller=M;var f=function(){function e(){this.$view=new n;this.$model=new r;this.$controller=new M;if(e.inst!==null){throw Error("重复构建PureMVC外观类！！！")}e.inst=this;this.$initializeFacade()}e.getInstance=function(){if(e.inst===null){e.inst=new e}return e.inst};e.prototype.$initializeFacade=function(){this.$initMsgQ();this.$initializeModel();this.$initializeController();this.$initializeView()};e.prototype.$initMsgQ=function(){d.scope=new o;d.locker=new o;d.msgQMap["sun"]=suncore.MsgQModEnum.KAL;d.msgQMap["MMI"]=suncore.MsgQModEnum.MMI};e.prototype.$initializeModel=function(){};e.prototype.$initializeView=function(){};e.prototype.$initializeController=function(){};e.prototype.$regMMICmd=function(e,t){this.$regMsgQCmd(e,t);d.mmiMsgQMap[e]=true};e.prototype.$regMsgQCmd=function(e,t){d.checkPrefix=true;d.msgQMap[t]=e;d.msgQCmd[e]=t};e.prototype.$setCareStatForCmd=function(e){this.$view.setCareStatForCmd(e)};e.prototype.registerObserver=function(e,t,r,o,i,s){d.active(suncore.MsgQModEnum.MMI);var n=this.$view.registerObserver(e,t,r,o,i,s);d.deactive()};e.prototype.removeObserver=function(e,t,r){d.active(suncore.MsgQModEnum.MMI);this.$view.removeObserver(e,t,r);d.deactive()};e.prototype.hasObserver=function(e,t,r){d.deactive();return this.$view.hasObserver(e,t,r)};e.prototype.registerCommand=function(e,t,r,o){d.deactive();this.$controller.registerCommand(e,t,r,o)};e.prototype.removeCommand=function(e){d.deactive();this.$controller.removeCommand(e)};e.prototype.hasCommand=function(e){d.deactive();return this.$controller.hasCommand(e)};e.prototype.registerProxy=function(e){d.active(suncore.MsgQModEnum.MMI);this.$model.registerProxy(e);d.deactive()};e.prototype.removeProxy=function(e){d.active(suncore.MsgQModEnum.MMI);this.$model.removeProxy(e);d.deactive()};e.prototype.retrieveProxy=function(e){d.active(suncore.MsgQModEnum.MMI);var t=this.$model.retrieveProxy(e);d.deactive();return t};e.prototype.hasProxy=function(e){d.deactive();return this.$model.hasProxy(e)};e.prototype.registerMediator=function(e){d.active(suncore.MsgQModEnum.MMI);this.$view.registerMediator(e);d.deactive()};e.prototype.removeMediator=function(e){d.active(suncore.MsgQModEnum.MMI);this.$view.removeMediator(e);d.deactive()};e.prototype.retrieveMediator=function(e){d.active(suncore.MsgQModEnum.MMI);var t=this.$view.retrieveMediator(e);d.deactive();return t};e.prototype.hasMediator=function(e){d.deactive();return this.$view.hasMediator(e)};e.prototype.sendNotification=function(e,t,r,o){d.active(suncore.MsgQModEnum.MMI);this.$view.notifyObservers(e,t,r,o);d.deactive()};e.prototype.notifyCancel=function(){d.deactive();this.$view.notifyCancel()};e.DEBUG=true;e.inst=null;return e}();l.Facade=f;var r=function(){function e(){this.$proxies={};if(e.inst!==null){throw Error("重复构建模型类！！！")}e.inst=this}e.prototype.registerProxy=function(e){var t=e.getProxyName();if(p(t)===true){throw Error("注册无效的模型类")}if(this.hasProxy(t)===true){throw Error("重复注册模型类："+t)}this.$proxies[t]=e;e.onRegister()};e.prototype.removeProxy=function(e){if(p(e)===true){throw Error("移除无效的模型类")}if(this.hasProxy(e)===false){throw Error("移除不存在的模型类："+e)}var t=this.$proxies[e];delete this.$proxies[e];t.onRemove()};e.prototype.retrieveProxy=function(e){if(d.enableMMIAction()===false){throw Error("非MMI模块禁用接口")}return this.$proxies[e]||null};e.prototype.hasProxy=function(e){if(d.enableMMIAction()===false){throw Error("非MMI模块禁用接口")}return this.$proxies[e]!==void 0};e.inst=null;return e}();l.Model=r;var o=function(){function i(){this.$actMsgQMod=suncore.MsgQModEnum.NIL;this.$curMsgQMod=suncore.MsgQModEnum.NIL;this.$target={};this.$snapshots=[]}i.prototype.asserts=function(e,t){if(e===suncore.MsgQModEnum.KAL){return}if(this.$curMsgQMod===suncore.MsgQModEnum.NIL||this.$curMsgQMod===suncore.MsgQModEnum.KAL){return}if(this.$curMsgQMod===suncore.MsgQModEnum.MMI){if(e===suncore.MsgQModEnum.MMI||d.mmiMsgQMap[e]===true){return}}else if(this.$curMsgQMod===e){return}else if(e===suncore.MsgQModEnum.MMI&&d.mmiMsgQMap[this.$curMsgQMod]===true){return}if(t===null){throw Error("禁止跨模块传递消息，src:"+suncore.MsgQModEnum[this.$curMsgQMod]+", dest:"+suncore.MsgQModEnum[e])}else{throw Error("禁止跨模块监听消息，src:"+suncore.MsgQModEnum[this.$curMsgQMod]+", dest:"+suncore.MsgQModEnum[e])}};i.prototype.update=function(e){this.$target=e;if(e instanceof l.Notifier){this.$actMsgQMod=e.msgQMod}else{this.$actMsgQMod=suncore.MsgQModEnum.MMI}var t=e[i.MUTEX_PREFIX_KEY]||null;if(t===null){this.$curMsgQMod=this.$actMsgQMod}else{this.$curMsgQMod=d.msgQMap[t]}};i.prototype.lock=function(e){var t=this.$target[i.MUTEX_REFERENCE_KAL]||0;var r=this.$target[i.MUTEX_REFERENCE_MMI]||0;var o=this.$target[i.MUTEX_REFERENCE_ANY]||0;if(e===suncore.MsgQModEnum.KAL){t++}else if(e===suncore.MsgQModEnum.MMI){r++}else{o++}if(this.$curMsgQMod===suncore.MsgQModEnum.NIL||this.$curMsgQMod===suncore.MsgQModEnum.KAL){this.$curMsgQMod=e}else if(this.$curMsgQMod===suncore.MsgQModEnum.MMI&&e!==suncore.MsgQModEnum.KAL){this.$curMsgQMod=e}this.$cache(t,r,o,false)};i.prototype.unlock=function(e){var t=this.$target[i.MUTEX_REFERENCE_KAL]||0;var r=this.$target[i.MUTEX_REFERENCE_MMI]||0;var o=this.$target[i.MUTEX_REFERENCE_ANY]||0;if(e===suncore.MsgQModEnum.KAL){t--}else if(e===suncore.MsgQModEnum.MMI){r--}else{o--}if(t<0||r<0||o<0){throw Error("互斥体释放错误：KAL["+t+"], MMI["+r+"], ANY["+o+"]")}if(this.$curMsgQMod===this.$actMsgQMod){}else if(o>0){}else if(r>0){this.$curMsgQMod=suncore.MsgQModEnum.MMI}else if(t>0){this.$curMsgQMod=suncore.MsgQModEnum.KAL}else{this.$curMsgQMod=this.$actMsgQMod}this.$cache(t,r,o,true)};i.prototype.active=function(e){if(this.$actMsgQMod===suncore.MsgQModEnum.NIL){this.$actMsgQMod=this.$curMsgQMod=e}};i.prototype.deactive=function(){var e=this.$target[i.MUTEX_REFERENCE_KAL]||0;var t=this.$target[i.MUTEX_REFERENCE_MMI]||0;var r=this.$target[i.MUTEX_REFERENCE_ANY]||0;if(e===0&&t===0&&r===0){this.$actMsgQMod=this.$curMsgQMod=suncore.MsgQModEnum.NIL}};i.prototype.$cache=function(e,t,r,o){if(e>0){this.$target[i.MUTEX_REFERENCE_KAL]=e}else if(o===true&&this.$target[i.MUTEX_REFERENCE_KAL]>0){delete this.$target[i.MUTEX_REFERENCE_KAL]}if(t>0){this.$target[i.MUTEX_REFERENCE_MMI]=t}else if(o===true&&this.$target[i.MUTEX_REFERENCE_MMI]>0){delete this.$target[i.MUTEX_REFERENCE_MMI]}if(r>0){this.$target[i.MUTEX_PREFIX_KEY]=d.msgQCmd[this.$curMsgQMod];this.$target[i.MUTEX_REFERENCE_ANY]=r}else if(o===true&&this.$target[i.MUTEX_REFERENCE_ANY]>0){delete this.$target[i.MUTEX_PREFIX_KEY];delete this.$target[i.MUTEX_REFERENCE_ANY]}};i.prototype.backup=function(e){var t=null;if(e instanceof l.Notifier){t=e.msgQMod}else{t=suncore.MsgQModEnum.MMI}if(t!==this.$curMsgQMod){var r={data:this.$target,actMsgQMod:this.$actMsgQMod,curMsgQMod:this.$curMsgQMod};this.$snapshots.push(r);this.$target={};this.$actMsgQMod=this.$curMsgQMod=t}else{this.$snapshots.push(null)}};i.prototype.restore=function(){var e=this.$snapshots.pop()||null;if(e!==null){this.$target=e.data;this.$actMsgQMod=e.actMsgQMod;this.$curMsgQMod=e.curMsgQMod}};Object.defineProperty(i.prototype,"curMsgQMod",{get:function(){return this.$curMsgQMod},enumerable:false,configurable:true});i.MUTEX_PREFIX_KEY="puremvc$mutex$prefix";i.MUTEX_REFERENCE_KAL="puremvc$mutex$reference$kal";i.MUTEX_REFERENCE_MMI="puremvc$mutex$reference$mmi";i.MUTEX_REFERENCE_ANY="puremvc$mutex$reference$any";return i}();l.MutexScope=o;var e=function(){function e(e){this.$facade=f.getInstance();this.$msgQMod=suncore.MsgQModEnum.MMI;this.$destroyed=false;if(e!==void 0){this.$msgQMod=e}}e.prototype.destroy=function(){this.$destroyed=true};Object.defineProperty(e.prototype,"facade",{get:function(){d.active(this.$msgQMod);return this.$facade},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"msgQMod",{get:function(){return this.$msgQMod},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"destroyed",{get:function(){return this.$destroyed},enumerable:false,configurable:true});return e}();l.Notifier=e;var h=function(){function e(){this.name=null;this.caller=null;this.method=null;this.option=null;this.priority=suncom.EventPriorityEnum.MID;this.receiveOnce=false}return e}();l.Observer=h;var i=function(o){__extends(e,o);function e(e,t){var r=o.call(this)||this;r.$proxyName=null;r.$data=void 0;if(p(e)===true){throw Error("无效的模型类名字")}r.$data=t;r.$proxyName=e;return r}e.prototype.getProxyName=function(){return this.$proxyName||null};e.prototype.onRegister=function(){};e.prototype.onRemove=function(){};e.prototype.getData=function(){return this.$data};e.prototype.setData=function(e){this.$data=e};return e}(e);l.Proxy=i;var s=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(e);l.SimpleCommand=s;var n=function(){function e(){this.$pool=[];this.$lockers={};this.$observers={};this.$isCanceled=false;this.$onceObservers=[];this.$mediators={};this.$modStatMap={};this.$careStatCmds={};if(e.inst!==null){throw Error("重复构建视图类！！！")}e.inst=this;this.registerObserver(suncore.NotifyKey.START_TIMELINE,this.$onStartTimeline,this);this.registerObserver(suncore.NotifyKey.PAUSE_TIMELINE,this.$onPauseTimeline,this)}e.prototype.$onStartTimeline=function(e,t){if(t===false){this.$modStatMap[e]=true}else{this.$modStatMap[e]=false}};e.prototype.$onPauseTimeline=function(e,t){this.$modStatMap[e]=false};e.prototype.setCareStatForCmd=function(e){this.$careStatCmds[e]=true};e.prototype.registerObserver=function(e,t,r,o,i,s){if(o===void 0){o=false}if(i===void 0){i=suncom.EventPriorityEnum.MID}if(s===void 0){s=1}if(p(e)===true){throw Error("注册无效的监听")}if(t===void 0||t===null){throw Error("注册无效的监听回调："+e)}if(r===void 0){r=null}var n=this.$observers[e];if(n===void 0){n=this.$observers[e]=[]}else if(this.$lockers[e]===true){this.$lockers[e]=false;this.$observers[e]=n=n.slice()}s=this.$createOption(s);if(s.delay===void 0){s.delay=1}if(s.delay<1){throw Error("事件响应间隔应当大于0")}s.counter=0;var u=-1;for(var a=0;a<n.length;a++){var c=n[a];if(c.method===t&&c.caller===r){f.DEBUG===true&&console.warn("忽略重复注册的监听 name:"+e);return null}if(u===-1&&c.priority<i){u=a}}d.create(e,r);var M=this.$pool.length>0?this.$pool.pop():new h;M.name=e;M.caller=r;M.method=t;M.option=s;M.priority=i;M.receiveOnce=o;if(u<0){n.push(M)}else{n.splice(u,0,M)}return M};e.prototype.$createOption=function(e){if(typeof e==="number"){if(e<t.NONE){return{delay:e}}else{if(e===t.CUSTOM){return{careStatMod:suncore.ModuleEnum.CUSTOM}}else if(e===t.TIMELINE){return{careStatMod:suncore.ModuleEnum.TIMELINE}}}}else if(e instanceof Array){return{args:e}}else{return e}};e.prototype.removeObserver=function(e,t,r){if(p(e)===true){throw Error("移除无效的监听")}if(t===void 0||t===null){throw Error("移除无效的监听回调："+e)}if(r===void 0){r=null}var o=this.$observers[e];if(o===void 0){return}if(this.$lockers[e]===true){this.$lockers[e]=false;this.$observers[e]=o=o.slice()}for(var i=0;i<o.length;i++){var s=o[i];if(s.method===t&&s.caller===r){o.splice(i,1);this.$pool.push(s);d.release(e,r);break}}if(o.length===0){delete this.$lockers[e];delete this.$observers[e]}};e.prototype.hasObserver=function(e,t,r){if(t===void 0){t=null}if(r===void 0){r=null}if(p(e)===true){throw Error("查询无效的监听")}if(t===null&&r===null){throw Error("method和caller不允许同时为空")}var o=this.$observers[e];if(o===void 0){return false}for(var i=0;i<o.length;i++){var s=o[i];if(t===null){if(s.caller===r){return true}}else if(r===null){if(s.method===t){return true}}else if(s.method===t&&s.caller===r){return true}}return false};e.prototype.notifyObservers=function(e,t,r,o){if(r===void 0){r=true}if(o===void 0){o=false}if(p(e)===true){throw Error("派发无效的通知")}var i=this.$observers[e];if(i===void 0){return}this.$lockers[e]=true;d.lock(e);var s=this.$isCanceled;this.$isCanceled=false;for(var n=0;n<i.length;n++){var u=i[n];var a=u.option;if(this.$careStatCmds[e]===true&&o===false){if(a.careStatMod!==void 0&&this.$modStatMap[a.careStatMod]!==true){continue}}if(u.receiveOnce===true){this.$onceObservers.push(u)}if(u.caller!==null&&u.caller.destroyed===true){if(suncom&&suncom["Common"]){console.warn("对象["+suncom["Common"].getQualifiedClassName(u.caller)+"]己销毁，未能响应"+e+"事件。")}else{console.warn("对象己销毁，未能响应"+e+"事件。")}continue}if(a.delay>1){a.counter++;if(a.counter<a.delay){continue}a.counter=0}var c=a.args?a.args.concat(t):t;if(u.caller===M.inst){u.method.call(u.caller,e,c)}else if(c instanceof Array){u.method.apply(u.caller,c)}else{u.method.call(u.caller,c)}if(this.$isCanceled){if(r===true){break}console.error("尝试取消不可被取消的通知："+e);this.$isCanceled=false}}this.$isCanceled=s;this.$lockers[e]=false;d.unlock(e);while(this.$onceObservers.length>0){var u=this.$onceObservers.pop();this.removeObserver(u.name,u.method,u.caller)}};e.prototype.notifyCancel=function(){this.$isCanceled=true};e.prototype.registerMediator=function(e){var t=e.getMediatorName();if(p(t)===true){throw Error("注册无效的中介者对象")}if(this.hasMediator(t)===true){throw Error("重复注册中介者对象"+t)}this.$mediators[t]=e;e.listNotificationInterests();e.onRegister()};e.prototype.removeMediator=function(e){if(p(e)===true){throw Error("移除无效的中介者对象")}if(this.hasMediator(e)===false){throw Error("移除不存在的中介者对象"+e)}var t=this.$mediators[e];delete this.$mediators[e];t.removeNotificationInterests();t.onRemove()};e.prototype.retrieveMediator=function(e){if(d.enableMMIAction()===false){throw Error("非MMI模块禁用接口")}return this.$mediators[e]||null};e.prototype.hasMediator=function(e){if(d.enableMMIAction()===false){throw Error("非MMI模块禁用接口")}return this.$mediators[e]!==void 0};e.inst=null;return e}();l.View=n;var u=function(t){__extends(e,t);function e(){var e=t.call(this)||this;e.$commands=[];e.$initializeMacroCommand();return e}e.prototype.$addSubCommand=function(e){this.$commands.push(e)};e.prototype.execute=function(){for(var e=0;e<this.$commands.length;e++){var t=new this.$commands[e];t.execute.apply(t,arguments)}};return e}(e);l.MacroCommand=u;var a=function(o){__extends(e,o);function e(e,t){var r=o.call(this)||this;r.$mediatorName=null;r.$notificationInterests=[];r.$viewComponent=null;if(p(e)===true){throw Error("无效的中介者对象名字")}r.$mediatorName=e;r.$viewComponent=t||null;return r}e.prototype.getMediatorName=function(){return this.$mediatorName};e.prototype.listNotificationInterests=function(){};e.prototype.removeNotificationInterests=function(){for(var e=0;e<this.$notificationInterests.length;e++){var t=this.$notificationInterests[e];n.inst.removeObserver(t.name,t.method,t.caller)}};e.prototype.$handleNotification=function(e,t,r,o){if(r===void 0){r=suncom.EventPriorityEnum.MID}var i=n.inst.registerObserver(e,t,this,void 0,r,o);i&&this.$notificationInterests.push(i)};e.prototype.onRegister=function(){};e.prototype.onRemove=function(){};e.prototype.getViewComponent=function(){return this.$viewComponent};e.prototype.setViewComponent=function(e){this.$viewComponent=e||null};return e}(e);l.Mediator=a;var d;(function(i){i.MMI_COMMAND_PREFIX="MMI";i.KERNEL_COMMAND_PREFIX="sun";i.scope=null;i.locker=null;i.checkPrefix=false;i.msgQMap={};i.msgQCmd={};i.mmiMsgQMap={};function s(e){if(e.substr(0,3)===i.KERNEL_COMMAND_PREFIX){return i.KERNEL_COMMAND_PREFIX}var t=e.indexOf("_");if(t<1){throw Error("必须为命令指定一个模块名，格式如 MOD_"+e)}var r=e.substr(0,t);if(i.msgQMap[r]===void 0){throw Error("未注册的MsgQ消息前缀："+r)}return r}function e(){if(i.checkPrefix===false){return true}if(i.scope.curMsgQMod===suncore.MsgQModEnum.NIL||i.scope.curMsgQMod===suncore.MsgQModEnum.KAL||i.scope.curMsgQMod===suncore.MsgQModEnum.MMI){return true}return i.mmiMsgQMap[i.scope.curMsgQMod]===true}i.enableMMIAction=e;function t(e){if(i.checkPrefix===true){i.scope.active(e)}}i.active=t;function r(){if(i.checkPrefix===true){i.scope.deactive()}}i.deactive=r;function o(e){if(i.checkPrefix===false){return}var t=s(e);var r=i.msgQMap[t];i.scope.asserts(r,null);i.scope.lock(r)}i.lock=o;function n(e){if(i.checkPrefix===false){return}var t=s(e);var r=i.msgQMap[t];i.scope.asserts(r,null);i.scope.unlock(r)}i.unlock=n;function u(e,t){if(i.checkPrefix===false){return}if(t===null||t===l.Controller.inst||t===l.View.inst){return}var r=s(e);var o=i.msgQMap[r];i.locker.update(t);i.locker.asserts(o,t);i.locker.lock(o)}i.create=u;function a(e,t){if(i.checkPrefix===false){return}if(t===null||t===l.Controller.inst||t===l.View.inst){return}var r=s(e);var o=i.msgQMap[r];i.locker.update(t);i.locker.asserts(o,t);i.locker.unlock(o)}i.release=a;function c(e){if(i.checkPrefix===true){i.scope.backup(e)}}i.backup=c;function M(){if(i.checkPrefix===true){i.scope.restore()}}i.restore=M})(d=l.MutexLocker||(l.MutexLocker={}));function p(e){return e===void 0||e===null||e===""}l.isStringNullOrEmpty=p})(puremvc||(puremvc={}));