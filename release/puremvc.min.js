var __extends=this&&this.__extends||function(){var o=function(t,e){o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]};return o(t,e)};return function(t,e){o(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}();var puremvc;(function(l){var c=function(){function t(){this.$commands={};if(t.inst!==null){throw Error("重复构建控制类！！！")}t.inst=this}t.prototype.executeCommand=function(t,e){var r=new this.$commands[t];if(e instanceof Array){r.execute.apply(r,e)}else{r.execute.call(r,e)}};t.prototype.registerCommand=function(t,e,r,o){if(this.hasCommand(t)===true){throw Error("重复注册命令："+t)}this.$commands[t]=e;n.inst.registerObserver(t,this.executeCommand,this,false,r,o)};t.prototype.removeCommand=function(t){if(this.hasCommand(t)===false){throw Error("移除不存在的命令："+t)}delete this.$commands[t];n.inst.removeObserver(t,this.executeCommand,this)};t.prototype.hasCommand=function(t){return this.$commands[t]!==void 0};t.inst=null;return t}();l.Controller=c;var e=function(){function t(){this.$var_view=new n;this.$var_model=new r;this.$var_controller=new c;if(t.inst!==null){throw Error("重复构建PureMVC外观类！！！")}t.inst=this;this.$func_initializeFacade()}t.getInstance=function(){if(t.inst===null){t.inst=new t}return t.inst};t.prototype.$func_initializeFacade=function(){this.$initializeModel();this.$initializeController();this.$initializeView()};t.prototype.$initializeModel=function(){};t.prototype.$initializeView=function(){};t.prototype.$initializeController=function(){};t.prototype.registerObserver=function(t,e,r,o,i,n){this.$var_view.registerObserver(t,e,r,o,i,n)};t.prototype.removeObserver=function(t,e,r){this.$var_view.removeObserver(t,e,r)};t.prototype.hasObserver=function(t,e,r){return this.$var_view.hasObserver(t,e,r)};t.prototype.registerCommand=function(t,e,r,o){this.$var_controller.registerCommand(t,e,r,o)};t.prototype.removeCommand=function(t){this.$var_controller.removeCommand(t)};t.prototype.hasCommand=function(t){return this.$var_controller.hasCommand(t)};t.prototype.registerProxy=function(t){this.$var_model.registerProxy(t)};t.prototype.removeProxy=function(t){this.$var_model.removeProxy(t)};t.prototype.retrieveProxy=function(t){return this.$var_model.retrieveProxy(t)};t.prototype.hasProxy=function(t){return this.$var_model.hasProxy(t)};t.prototype.registerMediator=function(t){this.$var_view.registerMediator(t)};t.prototype.removeMediator=function(t){this.$var_view.removeMediator(t)};t.prototype.retrieveMediator=function(t){return this.$var_view.retrieveMediator(t)};t.prototype.hasMediator=function(t){return this.$var_view.hasMediator(t)};t.prototype.sendNotification=function(t,e,r){this.$var_view.notifyObservers(t,e,r)};t.prototype.notifyCancel=function(){this.$var_view.notifyCancel()};t.DEBUG=true;t.inst=null;return t}();l.Facade=e;var r=function(){function t(){this.$proxies={};if(t.inst!==null){throw Error("重复构建模型类！！！")}t.inst=this}t.prototype.registerProxy=function(t){var e=t.func_getProxyName();if(suncom.Common.isStringNullOrEmpty(e)===true){throw Error("注册无效的模型类")}if(this.hasProxy(e)===true){throw Error("重复注册模型类："+e)}this.$proxies[e]=t;t.onRegister()};t.prototype.removeProxy=function(t){if(suncom.Common.isStringNullOrEmpty(t)===true){throw Error("移除无效的模型类")}if(this.hasProxy(t)===false){throw Error("移除不存在的模型类："+t)}var e=this.$proxies[t];delete this.$proxies[t];e.onRemove()};t.prototype.retrieveProxy=function(t){return this.$proxies[t]||null};t.prototype.hasProxy=function(t){return this.$proxies[t]!==void 0};t.inst=null;return t}();l.Model=r;var t=function(){function t(){this.$var_facade=e.getInstance();this.$destroyed=false}t.prototype.destroy=function(){this.$destroyed=true};Object.defineProperty(t.prototype,"facade",{get:function(){return this.$var_facade},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"destroyed",{get:function(){return this.$destroyed},enumerable:false,configurable:true});return t}();l.Notifier=t;var f=function(){function t(){this.args=null;this.name=null;this.caller=null;this.method=null;this.priority=suncom.EventPriorityEnum.MID;this.receiveOnce=false}return t}();l.Observer=f;var o=function(o){__extends(t,o);function t(t,e){var r=o.call(this)||this;r.$var_proxyName=null;r.$var_lockData=null;r.$data=void 0;if(suncom.Common.isStringNullOrEmpty(t)===true){throw Error("无效的模型类名字")}r.$data=e;r.$var_proxyName=t;r.$lockJsonData(e);return r}t.prototype.func_getProxyName=function(){return this.$var_proxyName||null};t.prototype.onRegister=function(){};t.prototype.onRemove=function(){};t.prototype.getData=function(){return this.$data};t.prototype.setData=function(t){this.$data=t;if(this.$var_lockData===null){this.$lockJsonData(t)}};t.prototype.hasData=function(){return this.$data?true:false};t.prototype.hasDataStrictly=function(){return this.$data!==void 0};t.prototype.$lockJsonData=function(t){if(t instanceof Object&&t instanceof Array===false){this.$var_lockData=t}};t.prototype.$setDefaultJsonValue=function(t,e){if(this.$var_lockData[t]===void 0){this.$var_lockData[t]=e}};return t}(t);l.Proxy=o;var i=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(t);l.SimpleCommand=i;var n=function(){function t(){this.$pool=[];this.$lockers={};this.$observers={};this.$isCanceled=false;this.$onceObservers=[];this.$recycle=[];this.$notifyCount=0;this.$mediators={};if(t.inst!==null){throw Error("重复构建视图类！！！")}t.inst=this}t.prototype.registerObserver=function(t,e,r,o,i,n){if(o===void 0){o=false}if(i===void 0){i=suncom.EventPriorityEnum.MID}if(n===void 0){n=null}if(e===void 0){e=null}if(r===void 0){r=null}if(suncom.Common.isStringNullOrEmpty(t)===true){throw Error("注册无效的监听")}if(e===null){throw Error("注册无效的监听回调："+t)}var s=this.$observers[t];if(s===void 0){s=this.$observers[t]=[]}else if(this.$lockers[t]===true){this.$lockers[t]=false;this.$observers[t]=s=s.slice()}var a=-1;for(var u=0;u<s.length;u++){var l=s[u];if(l.method===e&&l.caller===r){suncom.Logger.warn("忽略重复注册的监听 name:"+t);return null}if(a===-1&&l.priority<i){a=u}}var c=this.$pool.length>0?this.$pool.pop():new f;c.args=n;c.name=t;c.caller=r;c.method=e;c.priority=i;c.receiveOnce=o;if(a<0){s.push(c)}else{s.splice(a,0,c)}return c};t.prototype.removeObserver=function(t,e,r){if(e===void 0){e=null}if(r===void 0){r=null}if(suncom.Common.isStringNullOrEmpty(t)===true){throw Error("移除无效的监听")}if(e===null){throw Error("移除无效的监听回调："+t)}var o=this.$observers[t];if(o===void 0){return}if(this.$lockers[t]===true){this.$lockers[t]=false;this.$observers[t]=o=o.slice()}for(var i=0;i<o.length;i++){var n=o[i];if(n.method===e&&n.caller===r){this.$recycle.push(o.splice(i,1)[0]);break}}if(o.length===0){delete this.$lockers[t];delete this.$observers[t]}};t.prototype.hasObserver=function(t,e,r){if(e===void 0){e=null}if(r===void 0){r=null}if(suncom.Common.isStringNullOrEmpty(t)===true){throw Error("查询无效的监听")}if(e===null){throw Error("查询无效的监听回调！！！")}var o=this.$observers[t];if(o===void 0){return false}for(var i=0;i<o.length;i++){var n=o[i];if(n.method===e&&n.caller===r){return true}}return false};t.prototype.notifyObservers=function(t,e,r){if(r===void 0){r=true}if(suncom.Common.isStringNullOrEmpty(t)===true){throw Error("派发无效的通知")}var o=this.$observers[t];if(o===void 0){return}this.$lockers[t]=true;var i=this.$isCanceled;this.$isCanceled=false;this.$notifyCount++;for(var n=0;n<o.length;n++){var s=o[n];var a=s.caller;if(s.receiveOnce===true){this.$onceObservers.push(s)}if(a!==null){if(a instanceof fairygui.GObject){if(a.isDisposed===true){suncom.Logger.warn("对象["+suncom.Common.getQualifiedClassName(a)+"]己销毁，未能响应"+t+"事件。")}}else if(a instanceof Laya.Node||a instanceof l.Notifier){if(a.destroyed===true){suncom.Logger.warn("对象["+suncom.Common.getQualifiedClassName(a)+"]己销毁，未能响应"+t+"事件。")}}else if(a instanceof suncore.BaseService){if(a.running===false){suncom.Logger.warn("服务["+suncom.Common.getQualifiedClassName(a)+"]己停止，未能响应"+t+"事件。")}}}var u=s.args===null?e:s.args.concat(e);if(s.caller===c.inst){s.method.call(s.caller,t,u)}else if(u instanceof Array){s.method.apply(s.caller,u)}else{s.method.call(s.caller,u)}if(this.$isCanceled){if(r===true){break}console.error("尝试取消不可被取消的通知："+t);this.$isCanceled=false}}this.$isCanceled=i;this.$lockers[t]=false;this.$notifyCount--;while(this.$onceObservers.length>0){var s=this.$onceObservers.pop();this.removeObserver(s.name,s.method,s.caller)}if(this.$notifyCount===0){while(this.$recycle.length>0){var s=this.$recycle.pop();s.args=s.caller=s.method=null;this.$pool.push(s)}}};t.prototype.notifyCancel=function(){this.$isCanceled=true};t.prototype.registerMediator=function(t){var e=t.func_getMediatorName();if(suncom.Common.isStringNullOrEmpty(e)===true){throw Error("注册无效的中介者对象")}if(this.hasMediator(e)===true){throw Error("重复注册中介者对象"+e)}this.$mediators[e]=t;t.listNotificationInterests();t.onRegister()};t.prototype.removeMediator=function(t){if(suncom.Common.isStringNullOrEmpty(t)===true){throw Error("移除无效的中介者对象")}if(this.hasMediator(t)===false){throw Error("移除不存在的中介者对象"+t)}var e=this.$mediators[t];delete this.$mediators[t];e.func_removeNotificationInterests();e.onRemove()};t.prototype.retrieveMediator=function(t){return this.$mediators[t]||null};t.prototype.hasMediator=function(t){return this.$mediators[t]!==void 0};t.inst=null;return t}();l.View=n;var s=function(e){__extends(t,e);function t(){var t=e.call(this)||this;t.$var_commands=[];t.$initializeMacroCommand();return t}t.prototype.$addSubCommand=function(t){this.$var_commands.push(t)};t.prototype.execute=function(){for(var t=0;t<this.$var_commands.length;t++){var e=new this.$var_commands[t];e.execute.apply(e,arguments)}};return t}(t);l.MacroCommand=s;var a=function(o){__extends(t,o);function t(t,e){var r=o.call(this)||this;r.$var_mediatorName=null;r.$var_notificationInterests=[];r.$viewComponent=null;if(suncom.Common.isStringNullOrEmpty(t)===true){throw Error("无效的中介者对象名字")}r.$var_mediatorName=t;r.$viewComponent=e||null;return r}t.prototype.$handleNotification=function(t,e,r,o){if(r===void 0){r=suncom.EventPriorityEnum.MID}var i=n.inst.registerObserver(t,e,this,void 0,r,o);i&&this.$var_notificationInterests.push(i)};t.prototype.func_getMediatorName=function(){return this.$var_mediatorName};t.prototype.listNotificationInterests=function(){};t.prototype.func_removeNotificationInterests=function(){for(var t=0;t<this.$var_notificationInterests.length;t++){var e=this.$var_notificationInterests[t];n.inst.removeObserver(e.name,e.method,e.caller)}};t.prototype.onRegister=function(){};t.prototype.onRemove=function(){};t.prototype.getViewComponent=function(){return this.$viewComponent};t.prototype.setViewComponent=function(t){this.$viewComponent=t||null};t.prototype.hasViewComponent=function(){return this.$viewComponent!==null};return t}(t);l.Mediator=a})(puremvc||(puremvc={}));